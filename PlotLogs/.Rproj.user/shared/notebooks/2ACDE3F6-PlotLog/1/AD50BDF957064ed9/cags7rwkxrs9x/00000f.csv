"0","# We are lookibng for lines beginning like this: GREPCOST - ITER,SIM,JO,JB,JC,JQ,JP,JA "
"0","get_cost_functions <- function(HM_DATE){"
"0","  "
"0","if ( any(str_detect(HM_DATE, ""4DVminim"")) ) {"
"0","  #This contains  output from a 4D-VAR minimization"
"0","  idx_cost <- which(str_detect(HM_DATE, ""Estimated quadratic cost""))"
"0","  idx_grad <- which(str_detect(HM_DATE, ""Estimated gradient norm""))"
"0","  tibble("
"0","    ITER = sapply(idx_cost, function(idx_cost) "
"0","      if( str_detect(HM_DATE[[idx_cost]],""Iteration"") ){"
"0","        as.numeric( str_extract(HM_DATE[[idx_cost]],""\\(?[0-9.]+\\)?"") )"
"0","      } else{"
"0","        0"
"0","      }"
"0","    ),"
"0","    COST = sapply(idx_cost, function(idx_cost) "
"0","      if( str_detect(HM_DATE[[idx_cost]],""Iteration"") ){"
"0","        as.numeric(unlist(strsplit(HM_DATE[[idx_cost]],"" +"") )[9] ) "
"0","      } else{"
"0","        as.numeric(unlist(strsplit(HM_DATE[[idx_cost]],"" +"") )[10] ) "
"0","      }"
"0","    ),"
"0","    "
"0","    GRADx10 = sapply(idx_grad, function(idx_grad) "
"0","      if( str_detect(HM_DATE[[idx_grad]],""Iteration"") ){"
"0","        as.numeric(unlist(strsplit(HM_DATE[[idx_grad]],"" +"") )[9] ) * 10."
"0","      } else{"
"0","        as.numeric(unlist(strsplit(HM_DATE[[idx_grad]],"" +"") )[10] ) * 10"
"0","      }"
"0","    ),"
"0","    LOOP = Nloop(ITER)"
"0",")"
"0","  "
"0","} else if (any(str_detect(HM_DATE, ""GREPCOST"")) ){ "
"0","  #output from 3D-VAR minimization"
"0","  idx <- which(str_detect(HM_DATE, ""GREPCOST ""))"
"0","  idx <- idx[seq(2,length(idx)-1)] #Don't know if this isi ok, really"
"0","  tibble("
"0","   ITER = sapply(idx, function(idx)"
"0","     as.numeric(unlist(str_extract_all(HM_DATE[[idx]],""\\(?[0-9.]+\\)?"") )[1] ) ),"
"0","   #SIM = sapply(idx, function(idx)"
"0","    # as.numeric(unlist(str_extract_all(HM_DATE[[idx]],""\\(?[0-9.]+\\)?"") )[2] )),"
"0","   JO = sapply(idx, function(idx)"
"0","     as.numeric(unlist(str_extract_all(HM_DATE[[idx]],""\\(?[0-9.]+\\)?"") )[3] )),"
"0","   JB = sapply(idx, function(idx)"
"0","     as.numeric(unlist(str_extract_all(HM_DATE[[idx]],""\\(?[0-9.]+\\)?"") )[4] )),"
"0","   JC = sapply(idx, function(idx)"
"0","     as.numeric(unlist(str_extract_all(HM_DATE[[idx]],""\\(?[0-9.]+\\)?"") )[5] )),"
"0","   JQ = sapply(idx, function(idx)"
"0","     as.numeric(unlist(str_extract_all(HM_DATE[[idx]],""\\(?[0-9.]+\\)?"") )[6] )),"
"0","   JP = sapply(idx, function(idx)"
"0","     as.numeric(unlist(str_extract_all(HM_DATE[[idx]],""\\(?[0-9.]+\\)?"") )[7] )),"
"0","   JA = sapply(idx+1, function(idx)"
"0","     as.numeric(unlist(str_extract_all(HM_DATE[[idx+1]],""\\(?[0-9.]+\\)?"") )[1] )),"
"0","   J = JO + JB + JC + JQ + JP + JA"
"0",")"
"0","} else {"
"0","  # no D/A "
"0","  return() }"
"0","}"
"0","#sapply(idx, function(idx) HM_DATE[[idx]])"
"0",""
